From: Vladis Dronov <vdronov@redhat.com>
Date: Thu, 26 Nov 2015 02:07:11 +0100
Subject: [PATCH] [input] wacom: fix crash on detecting device without endpoints

The wacom driver crashes on device detection when a specially crafted usb device
without endpoints is detected. This fix adds a check that the device has proper
configuration expected by the driver.

Reported-by: Ralf Spenneberg <ralf@spenneberg.net>
Signed-off-by: Vladis Dronov <vdronov@redhat.com>
---
 drivers/input/tablet/wacom_sys.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/input/tablet/wacom_sys.c b/drivers/input/tablet/wacom_sys.c
index 4ee7924..a1f1f0a 100644
--- a/drivers/input/tablet/wacom_sys.c
+++ b/drivers/input/tablet/wacom_sys.c
@@ -1317,6 +1317,11 @@ static int wacom_probe(struct usb_interface *intf, const struct usb_device_id *i
 	usb_make_path(dev, wacom->phys, sizeof(wacom->phys));
 	strlcat(wacom->phys, "/input0", sizeof(wacom->phys));
 
+	/* Verify that a device really has an endpoint */
+	if (intf->cur_altsetting->desc.bNumEndpoints < 1) {
+		error = -EINVAL;
+		goto fail3;
+	}
 	endpoint = &intf->cur_altsetting->endpoint[0].desc;
 
 	/* set the default size in case we do not get them from hid */
